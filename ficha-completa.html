<!DOCTYPE html>
<html lang="pt-pt">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ficha Cl√≠nica - ILPI</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
@media print { .no-print { display: none !important; } }
</style>
</head>

<body onload="carregarListaResidentes()">

<div class="container">

<header class="no-print">
<h1>Ficha Cl√≠nica Individual</h1>

<div style="margin-top:20px; display:flex; gap:15px; flex-wrap:wrap;">
<select id="selectResidente" onchange="gerarFicha()">
<option value="">Selecionar residente...</option>
</select>

<button class="btn-save" onclick="imprimirFicha()" style="background:var(--secondary-color);">
üñ®Ô∏è Imprimir
</button>

<button class="btn-save" onclick="gerarPDFSelecionado()">
üìÑ Gerar PDF
</button>
</div>
</header>

<div id="conteudoFicha" style="display:none; margin-top:30px;">

<h2 id="print_nome" style="text-align:center; border-bottom:2px solid var(--primary-color); padding-bottom:10px;"></h2>

<section>
<h3>√öltima Avalia√ß√£o</h3>
<p><strong>Data:</strong> <span id="f_data"></span></p>
<p><strong>IMC:</strong> <span id="f_imc"></span></p>
<p><strong>Classifica√ß√£o ICN:</strong> <span id="f_icn"></span></p>
</section>

<section>
<h3>Diagn√≥stico Nutricional (PES)</h3>
<div id="f_pes" style="background:#f5f5f5; padding:15px; border-radius:8px;"></div>
</section>

</div>

</div>

<script src="app.js"></script>

<script>

function carregarListaResidentes() {
    const banco = obterBanco();
    const select = document.getElementById("selectResidente");
    select.innerHTML = '<option value="">Selecionar residente...</option>';

    Object.keys(banco).sort().forEach(nome => {
        select.innerHTML += `<option value="${nome}">${nome}</option>`;
    });
}

function gerarFicha() {

    const nome = document.getElementById("selectResidente").value;
    if (!nome) return;

    const banco = obterBanco();
    const avs = banco[nome].avaliacoes;
    if (!avs || avs.length === 0) return;

    const ultima = avs[avs.length - 1];

    document.getElementById("conteudoFicha").style.display = "block";

    document.getElementById("print_nome").innerText = nome;
    document.getElementById("f_data").innerText = ultima.data || "-";
    document.getElementById("f_imc").innerText = ultima.imc || "-";
    document.getElementById("f_icn").innerText = ultima.classificacaoICN || "-";
    document.getElementById("f_pes").innerText = ultima.parecerPES || "-";
}

function gerarPDFSelecionado() {
    const nome = document.getElementById("selectResidente").value;
    if (!nome) return alert("Selecione um residente.");
    gerarPDFResidente(nome);
}

function imprimirFicha() {
    window.print();
}

</script>

</body>
</html>
