<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ficha Clínica Completa - ILPI</title>
<link rel="stylesheet" href="style.css">
<script src="app.js"></script>
</head>

<body>

<div class="navbar">
  <div class="navbar-inner">
    <img src="logo.png" class="logo">
    <div class="links">
      <a href="ficha-completa.html">Ficha Completa</a>
      <a href="exames.html">Exames</a>
      <a href="dashboard.html">Dashboard</a>
      <a href="relatorio.html">Direção</a>
    </div>
  </div>
</div>

<div class="container">

<h1>Ficha Clínica Completa ILPI</h1>

<!-- ================= IDENTIFICAÇÃO ================= -->

<h2>Identificação</h2>

<div class="grid">

<div>
<label>Setor</label>
<select id="setor">
<option>Suíte</option>
<option>Enfermaria</option>
</select>
</div>

<div>
<label>Data da Avaliação</label>
<input type="date" id="dataAvaliacao">
</div>

<div>
<label>Nome</label>
<input type="text" id="nome">
</div>

<div>
<label>Data de Admissão</label>
<input type="date" id="dataAdmissao">
</div>

<div>
<label>Data de Nascimento</label>
<input type="date" id="dataNascimento" onchange="atualizarIdade()">
</div>

<div>
<label>Idade</label>
<input type="text" id="idade" readonly>
</div>

<div>
<label>Gênero</label>
<select id="genero">
<option>Feminino</option>
<option>Masculino</option>
</select>
</div>

</div>

<!-- ================= ANTROPOMETRIA ================= -->

<h2>Antropometria</h2>

<div class="grid">

<div>
<label>Altura (m)</label>
<input type="number" step="0.01" id="altura" oninput="calcularAntropometria()">
</div>

<div>
<label>Peso Atual (kg)</label>
<input type="number" step="0.1" id="peso" oninput="calcularAntropometria()">
</div>

<div>
<label>Peso Habitual (kg)</label>
<input type="number" step="0.1" id="pesoHabitual">
</div>

<div>
<label>IMC (kg/m²)</label>
<input type="text" id="imc" readonly>
</div>

<div>
<label>Classificação IMC</label>
<input type="text" id="classImc" readonly>
</div>

</div>

<!-- ================= TRIAGEM ================= -->

<h2>Triagem Nutricional</h2>

<div class="grid">

<div>
<label>MNA (0–14)</label>
<input type="number" id="mna" min="0" max="14" oninput="calcularICNLocal()">
</div>

<div>
<label>NRS 2002 (0–7)</label>
<input type="number" id="nrs" min="0" max="7" oninput="calcularICNLocal()">
</div>

<div>
<label>ICN</label>
<input type="text" id="icn" readonly>
</div>

<div>
<label>Classificação Final</label>
<input type="text" id="classificacaoFinal" readonly>
</div>

</div>

<br><br>

<button onclick="salvarAvaliacao()">Salvar Avaliação</button>

</div>

<script>

/* ================= IDADE ================= */

function atualizarIdade(){
    const idadeNum = calcularIdade(dataNascimento.value);
    idade.value = idadeNum;
}

/* ================= ANTROPOMETRIA ================= */

function calcularAntropometria(){

    const pesoVal = Number(peso.value) || 0;
    const alturaVal = Number(altura.value) || 0;

    if(pesoVal > 0 && alturaVal > 0){

        const imcVal = pesoVal / (alturaVal * alturaVal);

        imc.value = imcVal.toFixed(2);
        classImc.value = classificarIMC(imcVal);

        calcularICNLocal();
    }
}

/* ================= ICN ================= */

function calcularICNLocal(){

    const mnaVal = Number(mna.value) || 0;
    const nrsVal = Number(nrs.value) || 0;
    const imcVal = Number(imc.value) || 0;

    const icnVal = calcularICN(mnaVal, nrsVal, imcVal);

    icn.value = icnVal.toFixed(2);
    classificacaoFinal.value = classificarICN(icnVal);
}

/* ================= SALVAR ================= */

function salvarAvaliacao(){

    if(!nome.value || !dataAvaliacao.value){
        alert("Preencha Nome e Data da Avaliação.");
        return;
    }

    const banco = obterBanco();
    const residente = nome.value.trim();

    if(!banco[residente]){
        banco[residente] = [];
    }

    const registro = {
        data: dataAvaliacao.value,
        setor: setor.value,
        genero: genero.value,
        idade: Number(idade.value) || 0,
        imc: Number(imc.value) || 0,
        icn: Number(icn.value) || 0,
        classificacao: classificacaoFinal.value,
        scoreBio: 0,
        indiceInflamatorio: 0,
        tfge: 0,
        riscoRenal: "",
        parecerClinico: ""
    };

    banco[residente].push(registro);

    salvarBanco(banco);

    alert("Avaliação salva com histórico individual.");
}

</script>

</body>
</html>
