<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Ficha Cl√≠nica Integrada - Lar Padre Euclides</title>
    <link rel="stylesheet" href="style.css">
    <script src="app.js"></script>
    <style>
        /* Estilos espec√≠ficos para a Ficha Cl√≠nica */
        .status-box {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            background: #f8f9fa;
            border: 1px solid #ddd;
        }
        .icn-alerta { background: #f8d7da; color: #721c24; border-color: #f5c6cb; }
        .icn-bom { background: #d4edda; color: #155724; border-color: #c3e6cb; }
    </style>
</head>
<body>

<div class="main-nav">
    <div class="navbar-inner">
        <a href="index.html">Calculadora</a>
        <a href="ficha-completa.html">Ficha Cl√≠nica</a>
        <a href="exames-laboratoriais.html">Exames</a>
        <a href="dashboard.html">Dashboard</a>
        <a href="metodologia.html">Metodologia</a>
    </div>
</div>

<div class="container">
    <header>
        <h1>Ficha Cl√≠nica Integrada</h1>
        <p>Monitoramento Nutricional de Residentes</p>
    </header>

    <section>
        <h3>Entrada de Dados</h3>
        <div class="grid">
            <div>
                <label>Nome do Residente</label>
                <input type="text" id="nome" placeholder="Nome completo">
            </div>
            <div>
                <label>Data da Avalia√ß√£o</label>
                <input type="date" id="data">
            </div>
            <div>
                <label>Peso (kg)</label>
                <input type="number" step="0.1" id="peso" oninput="atualizarICN()">
            </div>
            <div>
                <label>Altura (m)</label>
                <input type="number" step="0.01" id="altura" oninput="atualizarICN()">
            </div>
            <div>
                <label>Score MNA</label>
                <input type="number" id="mna" placeholder="0 a 30" oninput="atualizarICN()">
            </div>
            <div>
                <label>Score NRS</label>
                <input type="number" id="nrs" placeholder="0 a 7" oninput="atualizarICN()">
            </div>
        </div>
    </section>

    <section>
        <h3>Indicadores Gerados</h3>
        <div class="grid-results full">
            <div>
                <label>IMC Calculado</label>
                <input type="text" id="imc_result" readonly>
            </div>
            <div>
                <label>Conclus√£o Nutricional (ICN)</label>
                <input type="text" id="icn_result" readonly>
            </div>
        </div>
        <div id="boxStatus" class="status-box">
            Aguardando dados para an√°lise...
        </div>
    </section>

    <div class="actions">
        <button class="btn-save" onclick="salvarFicha()">üíæ Salvar na Base de Dados</button>
    </div>
</div>

<script>
// Fun√ß√£o para calcular o √çndice de Conclus√£o Nutricional (L√≥gica para o TCC)
function calcularICN(mna, nrs, imc) {
    // Crit√©rio: Se MNA < 17 ou NRS >= 3 ou IMC < 22 (idoso baixo peso)
    if (mna < 17 || nrs >= 3 || imc < 22) {
        return "ALTO RISCO / DESNUTRIDO";
    } else if (mna < 24 || nrs >= 1) {
        return "RISCO MODERADO";
    } else {
        return "ESTADO NORMAL";
    }
}

function atualizarICN() {
    const peso = parseFloat(document.getElementById("peso").value) || 0;
    const altura = parseFloat(document.getElementById("altura").value) || 0;
    const mna = parseFloat(document.getElementById("mna").value) || 0;
    const nrs = parseFloat(document.getElementById("nrs").value) || 0;
    const boxStatus = document.getElementById("boxStatus");

    if (peso > 0 && altura > 0) {
        const imc = peso / (altura * altura);
        document.getElementById("imc_result").value = imc.toFixed(2);
        
        const icn = calcularICN(mna, nrs, imc);
        document.getElementById("icn_result").value = icn;

        // Estiliza√ß√£o visual do resultado
        if (icn.includes("ALTO")) {
            boxStatus.innerText = "üö® Alerta: Interven√ß√£o imediata sugerida.";
            boxStatus.className = "status-box icn-alerta";
        } else if (icn.includes("MODERADO")) {
            boxStatus.innerText = "‚ö†Ô∏è Aten√ß√£o: Monitoramento quinzenal necess√°rio.";
            boxStatus.className = "status-box";
        } else {
            boxStatus.innerText = "‚úÖ Estabilidade: Manter conduta atual.";
            boxStatus.className = "status-box icn-bom";
        }
    }
}

function salvarFicha() {
    const nome = document.getElementById("nome").value;
    const data = document.getElementById("data").value;
    const imc = document.getElementById("imc_result").value;
    const icn = document.getElementById("icn_result").value;

    if (!nome || !data) {
        alert("Por favor, preencha pelo menos Nome e Data.");
        return;
    }

    const novaAvaliacao = {
        nome: nome,
        data: data,
        imc: imc,
        mnaTotal: document.getElementById("mna").value,
        nrsTotal: document.getElementById("nrs").value,
        mnaClass: icn, // Salvamos o ICN como a classifica√ß√£o principal
        parecer: "Ficha cl√≠nica integrada realizada em " + data
    };

    // Padr√£o de salvamento que usamos no sistema todo
    let lista = JSON.parse(localStorage.getItem("avaliacoes")) || [];
    lista.push(novaAvaliacao);
    localStorage.setItem("avaliacoes", JSON.stringify(lista));

    alert("Avalia√ß√£o salva com sucesso! Voc√™ pode visualiz√°-la no Dashboard.");
}
</script>

</body>
</html>
