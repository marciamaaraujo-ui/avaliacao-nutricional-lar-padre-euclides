<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Ficha Clínica - Lar Padre Euclides</title>
    <link rel="stylesheet" href="style.css">
</head>
<body onload="inicializarFicha()">

    <div class="navbar">
        <img src="logo.png" height="40" style="margin-right:20px;">
        <a href="index.html">Nova Avaliação</a>
        <a href="dashboard.html">Dashboard</a>
        <a href="ficha-completa.html">Ficha Clínica</a>
    </div>

    <div class="container">
        <header>
            <h1>Ficha Clínica Integrada</h1>
            <h2>Evolução Nutricional e Bioquímica</h2>
        </header>

        <section>
            <label>Pesquisar Residente:</label>
            <select id="selectResidente" onchange="carregarResidente()">
                <option value="">-- Selecionar para Visualização --</option>
            </select>
        </section>

        <div id="dadosFicha" style="display:none;">
            <section>
                <h3>Histórico de Avaliações (PES)</h3>
                <div id="historicoAvaliacoes"></div>
            </section>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        function inicializarFicha() {
            const banco = obterBanco();
            const select = document.getElementById("selectResidente");
            Object.keys(banco).sort().forEach(nome => {
                let opt = document.createElement("option");
                opt.value = nome;
                opt.textContent = nome;
                select.appendChild(opt);
            });
        }

        function carregarResidente() {
            const nome = document.getElementById("selectResidente").value;
            if(!nome) return;
            document.getElementById("dadosFicha").style.display = "block";
            
            const banco = obterBanco();
            const avais = banco[nome].avaliacoes;
            const container = document.getElementById("historicoAvaliacoes");
            container.innerHTML = "";

            avais.reverse().forEach(a => {
                container.innerHTML += `
                    <div style="padding:15px; border:1px solid #eee; margin-bottom:15px; border-radius:8px;">
                        <p><strong>Data:</strong> ${a.data}</p>
                        <p><strong>ICN:</strong> ${a.icn} (${a.classIcn})</p>
                        <p style="background:#f9f9f9; padding:10px; border-left:4px solid var(--primary-color); font-style:italic;">
                            ${a.parecer}
                        </p>
                    </div>
                `;
            });
        }
    </script>
</body>
</html>
