<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <title>Ficha Clínica - Lar Padre Euclides</title>
    <link rel="stylesheet" href="style.css">
</head>
<body onload="inicializarFicha()">

    <div class="navbar">
        <img src="logo.png" height="60" style="margin-right: 30px;">
        <a href="index.html">Nova Avaliação</a>
        <a href="dashboard.html">Dashboard</a>
        <a href="ficha-completa.html">Ficha Clínica</a>
    </div>

    <div class="container">
        <header>
            <h1>Histórico de Evolução</h1>
            <p>Consulta detalhada por residente</p>
        </header>

        <section style="background: var(--bg-input); padding: 30px; border-radius: 15px;">
            <label>Pesquisar Residente</label>
            <select id="selRes" onchange="verFicha()">
                <option value="">-- Selecione para abrir o prontuário --</option>
            </select>
        </section>

        <div id="fichaContent" style="display:none; margin-top: 50px;">
            <h2 id="nomeResidente" style="color: var(--primary-color); margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 10px;"></h2>
            
            <div id="linhaDoTempo"></div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        function inicializarFicha() {
            const b = obterBanco();
            const s = document.getElementById("selRes");
            Object.keys(b).sort().forEach(n => { s.innerHTML += `<option value="${n}">${n}</option>`; });
        }

        function verFicha() {
            const n = document.getElementById("selRes").value;
            const area = document.getElementById("fichaContent");
            if(!n) { area.style.display="none"; return; }
            
            area.style.display="block";
            document.getElementById("nomeResidente").innerText = n;
            
            const historico = obterBanco()[n].avaliacoes;
            const timeline = document.getElementById("linhaDoTempo");
            timeline.innerHTML = "";

            historico.reverse().forEach(a => {
                timeline.innerHTML += `
                    <div style="background: #fff; border: 1px solid #ddd; padding: 25px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.03);">
                        <div style="display: flex; justify-content: space-between; color: #666; font-size: 0.9rem; margin-bottom: 15px;">
                            <span>Data: <strong>${a.data}</strong></span>
                            <span>ICN: <strong>${a.icn}</strong></span>
                        </div>
                        <p><strong>Diagnóstico:</strong> <span style="color:var(--primary-color)">${a.classIcn}</span></p>
                        <div style="margin-top: 20px; padding: 15px; background: #fdfdfd; border-left: 5px solid var(--primary-color); font-style: italic;">
                            <strong>Parecer PES:</strong><br>
                            ${a.parecer}
                        </div>
                    </div>
                `;
            });
        }
    </script>
</body>
</html>
