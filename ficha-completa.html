<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <title>Ficha Clínica</title>
    <link rel="stylesheet" href="style.css">
</head>
<body onload="inicializarFicha()">

    <div class="navbar">
        <img src="logo.png" height="60" style="margin-right: 30px;">
        <a href="index.html">Nova Avaliação</a>
        <a href="dashboard.html">Dashboard</a>
        <a href="ficha-completa.html">Ficha Clínica</a>
    </div>

    <div class="container">
        <header>
            <h1>Prontuário de Evolução Nutricional</h1>
            <p>Consulta detalhada de diagnósticos e condutas anteriores</p>
        </header>

        <section style="background: var(--bg-input); padding: 40px; border-radius: 15px;">
            <label>Pesquisar Residente</label>
            <select id="selRes" onchange="carregarFicha()">
                <option value="">-- Selecionar para abrir o prontuário --</option>
            </select>
        </section>

        <div id="areaFicha" style="display:none; margin-top: 50px;">
            <h2 id="nomeFicha" style="color: var(--primary-color); border-bottom: 2px solid #eee; padding-bottom: 20px; margin-bottom: 40px;">-</h2>
            <div id="listaEvolucao"></div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        function inicializarFicha() {
            const b = obterBanco();
            const s = document.getElementById("selRes");
            Object.keys(b).sort().forEach(n => { s.innerHTML += `<option value="${n}">${n}</option>`; });
        }

        function carregarFicha() {
            const n = document.getElementById("selRes").value;
            const area = document.getElementById("areaFicha");
            if(!n) { area.style.display = "none"; return; }
            
            area.style.display = "block";
            document.getElementById("nomeFicha").innerText = "Residente: " + n;
            
            const avais = obterBanco()[n].avaliacoes;
            const lista = document.getElementById("listaEvolucao");
            lista.innerHTML = "";

            [...avais].reverse().forEach(a => {
                lista.innerHTML += `
                    <div style="margin-bottom:40px; padding:30px; border:1px solid #ddd; border-radius:12px; background: #fff;">
                        <p style="color:#666; font-size:0.9rem; margin-bottom: 10px;">Data da Avaliação: ${a.data}</p>
                        <p><strong>Diagnóstico ICN:</strong> <span style="font-weight:bold;">${a.classIcn}</span> (Escore: ${a.icn})</p>
                        <div style="background:#f9f9f9; padding:20px; border-left:6px solid var(--primary-color); margin-top:20px;">
                            <strong>Parecer Técnico (PES):</strong><br>
                            <span style="font-style:italic; line-height: 1.6;">${a.parecer}</span>
                        </div>
                    </div>`;
            });
        }
    </script>
</body>
</html>
