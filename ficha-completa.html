<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <title>Ficha Cl√≠nica - ILPI</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @media print { .no-print { display:none !important; } }
    </style>
</head>

<body onload="carregarListaResidentes()">

<div class="container">

<header class="no-print">
    <h1>Ficha Cl√≠nica Individual</h1>

    <div style="display:flex; gap:15px; margin-top:20px;">
        <select id="selectResidente" onchange="gerarFicha()">
            <option value="">Selecione o residente...</option>
        </select>

        <button class="btn-save" onclick="window.print()" style="background:var(--secondary-color);">
            üñ®Ô∏è Imprimir
        </button>

        <button class="btn-save" onclick="gerarPDFSelecionado()">
            üìÑ Gerar PDF
        </button>
    </div>
</header>

<div id="conteudoFicha" style="display:none; margin-top:30px;">

    <h2 id="print_nome"></h2>

    <section>
        <h3>Resumo Nutricional</h3>
        <p><strong>IMC:</strong> <span id="res_imc"></span></p>
        <p><strong>Classifica√ß√£o ICN:</strong> <span id="res_icn"></span></p>
    </section>

    <section>
        <h3>Diagn√≥stico (PES)</h3>
        <p id="res_parecer"></p>
    </section>

</div>

</div>

<script src="app.js"></script>

<script>

function carregarListaResidentes() {

    const banco = obterBanco();
    const select = document.getElementById("selectResidente");

    select.innerHTML = '<option value="">Selecione...</option>';

    Object.keys(banco).sort().forEach(nome => {
        const opt = document.createElement("option");
        opt.value = nome;
        opt.textContent = nome;
        select.appendChild(opt);
    });
}

function gerarFicha() {

    const nome = document.getElementById("selectResidente").value;
    if (!nome) return;

    const banco = obterBanco();
    const ultima = banco[nome].avaliacoes.slice(-1)[0];

    document.getElementById("conteudoFicha").style.display = "block";

    document.getElementById("print_nome").textContent = nome;
    document.getElementById("res_imc").textContent = ultima.imc || "-";
    document.getElementById("res_icn").textContent = ultima.classificacaoICN || "-";
    document.getElementById("res_parecer").textContent = ultima.parecerPES || "-";
}

function gerarPDFSelecionado() {

    const nome = document.getElementById("selectResidente").value;
    if (!nome) return alert("Selecione um residente.");

    gerarPDFResidente(nome);
}

</script>

</body>
</html>
