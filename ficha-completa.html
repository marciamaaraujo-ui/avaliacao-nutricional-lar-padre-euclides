<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <title>Relat√≥rio Individual - Lar Padre Euclides</title>
    <link rel="stylesheet" href="style.css">
</head>
<body onload="inicializarFicha()">
    <div class="navbar no-print">
        </div>

    <div class="container">
        <header>
            <img src="logo.png" style="height: 60px; margin-bottom: 10px;">
            <h1>Relat√≥rio Nutricional Individual</h1>
            <p id="dataRelatorio" style="font-weight: bold;"></p>
        </header>

        <section class="no-print">
            <label>Selecione o Residente para Gerar o Relat√≥rio:</label>
            <select id="selRes" onchange="gerarFichaCompleta()">
                <option value="">-- Escolher Residente --</option>
            </select>
        </section>

        <div id="conteudoRelatorio" style="display:none;">
            <section>
                <h3>1. Dados de Identifica√ß√£o</h3>
                <div id="dadosId" class="grid"></div>
            </section>

            <section>
                <h3>2. √öltima Avalia√ß√£o e Diagn√≥stico PES</h3>
                <div id="dadosNutri"></div>
            </section>

            <section>
                <h3>3. Quadro Cl√≠nico e Comorbidades</h3>
                <div id="dadosClinicos" style="line-height: 1.6;"></div>
            </section>

            <section>
                <h3>4. √öltimos Resultados Laboratoriais</h3>
                <div id="dadosExames"></div>
            </section>

            <button class="btn-save no-print" onclick="window.print()">üñ®Ô∏è IMPRIMIR RELAT√ìRIO INDIVIDUAL</button>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        function inicializarFicha() {
            const b = obterBanco();
            const s = document.getElementById("selRes");
            Object.keys(b).sort().forEach(n => { s.innerHTML += `<option value="${n}">${n}</option>`; });
            document.getElementById("dataRelatorio").innerText = "Gerado em: " + new Date().toLocaleDateString();
        }

        function gerarFichaCompleta() {
            const n = document.getElementById("selRes").value;
            if(!n) return;
            document.getElementById("conteudoRelatorio").style.display = "block";
            const res = obterBanco()[n];

            // 1. Identifica√ß√£o
            document.getElementById("dadosId").innerHTML = `
                <p><strong>Nome:</strong> ${n}</p>
                <p><strong>Sexo:</strong> ${res.perfil.sexo}</p>
                <p><strong>Nascimento:</strong> ${new Date(res.perfil.nasc).toLocaleDateString()}</p>
            `;

            // 2. Nutri√ß√£o (√öltima)
            const uA = res.avaliacoes.slice(-1)[0];
            document.getElementById("dadosNutri").innerHTML = `
                <p><strong>Status ICN:</strong> ${uA.classIcn}</p>
                <div style="background:#f9f9f9; padding:15px; border-left:5px solid var(--primary-color); margin-top:10px;">
                    <strong>Parecer T√©cnico (PES):</strong><br>${uA.parecer}
                </div>
            `;

            // 3. Comorbidades
            const com = res.comorbidades || [];
            document.getElementById("dadosClinicos").innerHTML = com.length > 0 ? 
                "<strong>Condi√ß√µes Diagnosticadas:</strong> " + com.join(", ") : 
                "Nenhuma comorbidade registrada.";

            // 4. Exames (√öltimo)
            const uE = res.exames.slice(-1)[0];
            if(uE) {
                document.getElementById("dadosExames").innerHTML = `
                    <p><strong>Data da Coleta:</strong> ${uE.data}</p>
                    <p>Albumina/PCR: ${uE.alb_pcr || '--'} | Glicemia: ${uE.glic || '--'} | Vit D: ${uE.vitd || '--'}</p>
                `;
            } else {
                document.getElementById("dadosExames").innerHTML = "Nenhum exame laboratoriais registado.";
            }
        }
    </script>
</body>
</html>
