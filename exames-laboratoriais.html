<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exames Laboratoriais - Painel Nutricional</title>
    <link rel="stylesheet" href="style.css">
</head>
<body onload="carregarResidentes()">

    <div class="navbar">
        <div class="nav-container">
            <img src="logo.png" alt="Logo" class="nav-logo">
            <div class="nav-links">
                <a href="index.html" class="nav-link">Nova Avalia√ß√£o</a>
                <a href="dashboard.html" class="nav-link">Dashboard</a>
                <a href="ficha-completa.html" class="nav-link">Ficha Cl√≠nica</a>
                <a href="exames-laboratoriais.html" class="nav-link home-btn">Exames</a>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>Registo de Exames Laboratoriais</h1>
            <p>Insira os resultados bioqu√≠micos para monitoriza√ß√£o cl√≠nica</p>
        </header>

        <section>
            <h3>1. Selecionar Residente</h3>
            <div class="grid">
                <div>
                    <label>Residente</label>
                    <select id="selectResidente">
                        <option value="">Selecione um residente...</option>
                    </select>
                </div>
                <div>
                    <label>Data da Colheita</label>
                    <input type="date" id="dataExame">
                </div>
            </div>
        </section>

        <section>
            <h3>2. Bioqu√≠mica e Hematologia</h3>
            <div class="grid">
                <div>
                    <label>Glic√©mia (mg/dL)</label>
                    <input type="number" id="glicemia" step="0.1" placeholder="Ref: 70-99">
                </div>
                <div>
                    <label>Albumina (g/dL)</label>
                    <input type="number" id="albumina" step="0.1" placeholder="Ref: 3.5-5.0">
                </div>
                <div>
                    <label>Hemoglobina (g/dL)</label>
                    <input type="number" id="hemoglobina" step="0.1">
                </div>
                <div>
                    <label>Colesterol Total (mg/dL)</label>
                    <input type="number" id="col_total" step="0.1">
                </div>
                <div>
                    <label>Creatinina (mg/dL)</label>
                    <input type="number" id="creatinina" step="0.01">
                </div>
                <div>
                    <label>Ureia (mg/dL)</label>
                    <input type="number" id="ureia" step="0.1">
                </div>
            </div>
            
            <div style="margin-top: 20px;">
                <label>Notas Adicionais / Outros Exames</label>
                <textarea id="notasExames" rows="3" placeholder="Ex: Vitaminas, eletr√≥litos ou observa√ß√µes..."></textarea>
            </div>

            <button class="btn-save" onclick="guardarExames()">üíæ Guardar Resultados</button>
        </section>
    </div>

    <script src="app.js"></script>
    <script>
        // Preenche o Select com os nomes que j√° existem no banco
        function carregarResidentes() {
            const banco = obterBanco();
            const select = document.getElementById("selectResidente");
            
            // Limpa op√ß√µes anteriores (exceto a primeira)
            select.innerHTML = '<option value="">Selecione um residente...</option>';
            
            Object.keys(banco).sort().forEach(nome => {
                const option = document.createElement("option");
                option.value = nome;
                option.textContent = nome;
                select.appendChild(option);
            });
        }

        function guardarExames() {
            const nome = document.getElementById("selectResidente").value;
            const data = document.getElementById("dataExame").value;

            if (!nome || !data) {
                alert("Por favor, selecione o residente e a data do exame.");
                return;
            }

            // Captura os dados usando a fun√ß√£o getNum do app.js
            const exame = {
                data: new Date(data).toLocaleDateString('pt-PT'),
                glicemia: getNum("glicemia"),
                albumina: getNum("albumina"),
                hemoglobina: getNum("hemoglobina"),
                col_total: getNum("col_total"),
                creatinina: getNum("creatinina"),
                ureia: getNum("ureia"),
                notas: document.getElementById("notasExames").value
            };

            // Salva no banco unificado (fun√ß√£o do app.js)
            salvarExame(nome, exame);

            alert("Exames de " + nome + " guardados com sucesso!");
            
            // Limpa o formul√°rio ou redireciona
            window.location.href = "dashboard.html";
        }
    </script>
</body>
</html>
