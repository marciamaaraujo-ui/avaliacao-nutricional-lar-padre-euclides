Para automatizar o parecer t칠cnico seguindo o modelo PES (Problema, Etiologia e Sinais/Sintomas), o sistema agora analisar치 os resultados calculados e montar치 a frase diagn칩stica de forma padronizada. Isso garante que a conduta seja t칠cnica e direta, facilitando a elabora칞칚o do relat칩rio para o Lar Padre Euclides.

Aqui est칚o os c칩digos finais atualizados com a automa칞칚o do PES integrada  fun칞칚o de c치lculos.

1. C칩digo Final: index.html
Este c칩digo agora inclui a l칩gica de gera칞칚o autom치tica de texto no campo de parecer.

HTML
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avalia칞칚o Nutricional - Lar Padre Euclides</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .navbar { display: flex; align-items: center; background: #fff; padding: 10px 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .nav-logo { height: 50px; margin-right: 20px; }
        .navbar a { text-decoration: none; color: #27ae60; font-weight: bold; margin-right: 15px; }
        .highlight-box { border: 1px dashed #27ae60; background: #fdfdfd; padding: 15px; margin-top: 15px; }
    </style>
</head>
<body>

    <div class="navbar">
        <img src="logo.png" alt="Lar Padre Euclides" class="nav-logo">
        <a href="index.html">Nova Avalia칞칚o</a>
        <a href="dashboard.html">Dashboard</a>
        <a href="ficha-completa.html">Ficha Cl칤nica</a>
        <a href="exames-laboratoriais.html">Exames</a>
    </div>

    <div class="container">
        <header>
            <h1>Avalia칞칚o Nutricional</h1>
            <h2>Triagem Integrada e Diagn칩stico PES</h2>
        </header>

        <form id="formAvaliacao">
            <section>
                <h3>1. Identifica칞칚o do Residente</h3>
                <div class="grid">
                    <input type="text" id="nome" placeholder="Nome Completo" required>
                    <select id="sexo" onchange="executarCalculos()">
                        <option value="F">Feminino</option>
                        <option value="M">Masculino</option>
                    </select>
                    <input type="date" id="dataNasc" onchange="atualizarIdade()">
                    <input type="date" id="dataAdmissao">
                    <input type="text" id="idade_display" readonly placeholder="Idade">
                    <input type="hidden" id="idade_val">
                </div>
            </section>

            <section>
                <h3>2. Antropometria e Estatura Estimada</h3>
                <div class="grid">
                    <input type="number" step="0.1" id="peso" placeholder="Peso (kg)" oninput="executarCalculos()">
                    <input type="number" step="0.01" id="altura" placeholder="Altura Real (m)" oninput="executarCalculos()">
                    <input type="number" step="0.1" id="altJoelho" placeholder="Alt. Joelho (cm)" oninput="executarCalculos()">
                </div>
                <div class="grid-results" style="margin-top:10px;">
                    <div>IMC: <input type="text" id="imc" readonly></div>
                    <div>Classifica칞칚o: <input type="text" id="classImc" readonly></div>
                    <div>Alt. Estimada: <input type="text" id="altEstimada" readonly></div>
                </div>
            </section>

            <section>
                <h3>3. Circunfer칡ncias Ajustadas (Prado et al. 2022)</h3>
                <div class="grid">
                    <input type="number" step="0.1" id="circBraco" placeholder="CB (cm)" oninput="executarCalculos()">
                    <input type="number" step="0.1" id="circPanturrilha" placeholder="CP (cm)" oninput="executarCalculos()">
                </div>
                <div class="grid-results" style="margin-top:10px;">
                    <div>CB Ajustada: <input type="text" id="cbAjustada" readonly></div>
                    <div>CP Ajustada: <input type="text" id="cpAjustada" readonly></div>
                </div>
            </section>

            <section>
                <h3>4. Rastreamento (MNA & NRS-2002)</h3>
                <div class="grid">
                    <input type="number" step="0.5" id="mna" placeholder="Score MNA (0-30)" oninput="executarCalculos()">
                    <input type="number" id="nrs" placeholder="Score NRS" oninput="executarCalculos()">
                </div>
                <div class="grid highlight-box">
                    <div>ICN: <input type="text" id="icn" readonly></div>
                    <div>Status: <input type="text" id="classIcn" readonly></div>
                </div>
            </section>

            <section>
                <h3>5. Diagn칩stico Nutricional (Modelo PES)</h3>
                <textarea id="parecer" rows="6" placeholder="O parecer ser치 gerado automaticamente aqui..."></textarea>
                <p style="font-size:0.8rem; color:#666; margin-top:5px;">*P: Problema | E: Etiologia | S: Sinais e Sintomas</p>
            </section>

            <button type="button" class="btn-save" onclick="processarSalvamento()">游 Salvar Avalia칞칚o Completa</button>
        </form>
    </div>

    <script src="app.js"></script>
    <script>
        function atualizarIdade() {
            const idade = calcularIdade(document.getElementById("dataNasc").value);
            document.getElementById("idade_display").value = idade + " anos";
            document.getElementById("idade_val").value = idade;
            executarCalculos();
        }

        function executarCalculos() {
            const peso = getNum("peso");
            let altura = getNum("altura");
            const aj = getNum("altJoelho");
            const idade = parseInt(document.getElementById("idade_val").value) || 0;
            const sexo = document.getElementById("sexo").value;

            if (altura === 0 && aj > 0 && idade > 0) {
                altura = estimarAltura(aj, idade, sexo);
                document.getElementById("altEstimada").value = altura.toFixed(2) + " m";
            }

            if (peso > 0 && altura > 0) {
                const imcVal = peso / (altura * altura);
                const cpOrig = getNum("circPanturrilha");
                const cbOrig = getNum("circBraco");
                const mna = getNum("mna");
                const nrs = getNum("nrs");

                document.getElementById("imc").value = imcVal.toFixed(2);
                document.getElementById("classImc").value = classificarIMC(imcVal);

                const cpAdj = ajustarCP(cpOrig, imcVal);
                const cbAdj = ajustarCB(cbOrig, imcVal, sexo);
                document.getElementById("cpAjustada").value = cpAdj.toFixed(1) + " cm";
                document.getElementById("cbAjustada").value = cbAdj.toFixed(1) + " cm";

                const icnVal = calcularICN(mna, nrs, imcVal);
                const statusIcn = classificarICN(icnVal);
                document.getElementById("icn").value = icnVal.toFixed(1);
                document.getElementById("classIcn").value = statusIcn;

                // GERA칂츾O AUTOM츼TICA DO PES
                document.getElementById("parecer").value = gerarParecerPES(statusIcn, imcVal, cpAdj, mna, nrs, sexo);
            }
        }

        function processarSalvamento() {
            const nome = document.getElementById("nome").value;
            if (!nome) return alert("Insira o nome!");
            const aval = {
                data: new Date().toISOString().split('T')[0],
                nome: nome,
                icn: document.getElementById("icn").value,
                classIcn: document.getElementById("classIcn").value,
                parecer: document.getElementById("parecer").value
            };
            salvarAvaliacao(nome, aval);
            alert("Salvo com sucesso!");
        }
    </script>
</body>
</html>
