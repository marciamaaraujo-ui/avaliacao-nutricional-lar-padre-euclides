<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ficha Nutricional ILPI</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="navbar">
  <div class="navbar-inner">
    <img src="logo.png" class="logo">
    <div class="links">
      <a href="index.html">Ficha Clínica</a>
      <a href="dashboard.html">Dashboard</a>
      <a href="metodologia.html">Metodologia</a>
    </div>
  </div>
</div>

<div class="container">

<h1>Ficha Nutricional ILPI</h1>

<div class="grid">

<div>
<label>Nome</label>
<input type="text" id="nome">
</div>

<div>
<label>Data</label>
<input type="date" id="data">
</div>

<div>
<label>Peso (kg)</label>
<input type="number" id="peso" step="0.1" oninput="calcularIMC()">
</div>

<div>
<label>Altura (m)</label>
<input type="number" id="altura" step="0.01" oninput="calcularIMC()">
</div>

<div>
<label>MNA (0–30)</label>
<input type="number" id="mnaTotal" oninput="calcularICN()">
</div>

<div>
<label>NRS (0–7)</label>
<input type="number" id="nrsTotal" oninput="calcularICN()">
</div>

<div>
<label>IMC</label>
<input type="text" id="imc" readonly>
</div>

<div>
<label>Classificação IMC</label>
<input type="text" id="classImc" readonly>
</div>

<div>
<label>ICN (0–100)</label>
<input type="text" id="icnScore" readonly>
</div>

<div>
<label>Classificação ICN</label>
<input type="text" id="icnClass" readonly>
</div>

</div>

<button onclick="salvar()">Salvar Avaliação</button>

</div>

<script>

function calcularIMC(){
  const p=parseFloat(peso.value);
  const a=parseFloat(altura.value);
  if(p && a){
    const imc=(p/(a*a)).toFixed(2);
    imcField=imc;
    document.getElementById("imc").value=imc;

    let classe="";
    if(imc<22) classe="Baixo Peso";
    else if(imc<=27) classe="Eutrofia";
    else classe="Sobrepeso";

    document.getElementById("classImc").value=classe;
  }
}

function calcularICN(){

  calcularIMC();

  const mna=parseFloat(mnaTotal.value)||0;
  const nrs=parseFloat(nrsTotal.value)||0;
  const imcClass=document.getElementById("classImc").value;

  const riscoMNA=((30-mna)/30)*100;
  const riscoNRS=(nrs/7)*100;

  let riscoIMC=10;
  if(imcClass==="Baixo Peso") riscoIMC=80;
  if(imcClass==="Sobrepeso") riscoIMC=20;

  const icn=(riscoMNA*0.5)+(riscoNRS*0.3)+(riscoIMC*0.2);

  document.getElementById("icnScore").value=icn.toFixed(1);

  let classFinal="";
  if(icn<30) classFinal="Normal";
  else if(icn<60) classFinal="Risco";
  else classFinal="Desnutrição";

  document.getElementById("icnClass").value=classFinal;

  return {icn, classFinal};
}

function salvar(){

  const resultado=calcularICN();

  const registro={
    nome:nome.value,
    data:data.value,
    score:resultado.icn,
    classificacao:resultado.classFinal
  };

  const dados=JSON.parse(localStorage.getItem("avaliacoes"))||[];
  dados.push(registro);
  localStorage.setItem("avaliacoes",JSON.stringify(dados));

  alert("Avaliação salva com sucesso!");
}

</script>

</body>
</html>
