<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avalia칞칚o Nutricional - Lar Padre Euclides</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="navbar">
        <a href="index.html">Nova Avalia칞칚o</a>
        <a href="dashboard.html">Dashboard</a>
        <a href="ficha-completa.html">Ficha Cl칤nica</a>
        <a href="exames-laboratoriais.html">Exames</a>
        <a href="metodologia.html">Metodologia</a>
    </div>

    <div class="container">
        <header>
            <h1>Avalia칞칚o Nutricional</h1>
            <h2>Lar Padre Euclides - Triagem Integrada</h2>
        </header>

        <form id="formAvaliacao">
            <section>
                <h3>1. Identifica칞칚o do Residente</h3>
                <div class="grid">
                    <div>
                        <label>Nome Completo</label>
                        <input type="text" id="nome" placeholder="Ex: Maria Oliveira" required>
                    </div>
                    <div>
                        <label>Data de Nascimento (para Idade)</label>
                        <input type="date" id="dataNasc" onchange="atualizarIdade()">
                    </div>
                    <div>
                        <label>Idade Atual</label>
                        <input type="text" id="idade" readonly placeholder="Calculada automaticamente">
                    </div>
                </div>
            </section>

            <section>
                <h3>2. Antropometria</h3>
                <div class="grid">
                    <div>
                        <label>Peso Atual (kg)</label>
                        <input type="number" step="0.1" id="peso" placeholder="00.0" oninput="executarCalculos()">
                    </div>
                    <div>
                        <label>Altura (m)</label>
                        <input type="number" step="0.01" id="altura" placeholder="0.00" oninput="executarCalculos()">
                    </div>
                    <div>
                        <label>IMC</label>
                        <input type="text" id="imc" readonly>
                    </div>
                    <div>
                        <label>Classifica칞칚o IMC</label>
                        <input type="text" id="classImc" readonly>
                    </div>
                </div>
            </section>

            <section>
                <h3>3. Rastreamento (MNA & NRS-2002)</h3>
                <div class="grid">
                    <div>
                        <label>MNA (Pontua칞칚o Total)</label>
                        <input type="number" id="mna" placeholder="0 a 30" oninput="executarCalculos()">
                    </div>
                    <div>
                        <label>NRS (Pontua칞칚o Total)</label>
                        <input type="number" id="nrs" placeholder="0 a 7" oninput="executarCalculos()">
                    </div>
                </div>
                
                <div class="grid" style="margin-top: 20px; background: #fdfdfd; padding: 15px; border: 1px dashed #27ae60;">
                    <div>
                        <label>칈ndice de Conclus칚o Nutricional (ICN)</label>
                        <input type="text" id="icn" readonly>
                    </div>
                    <div>
                        <label>Status de Risco Cl칤nico</label>
                        <input type="text" id="classIcn" readonly>
                    </div>
                </div>
            </section>

            <section>
                <h3>4. Parecer T칠cnico</h3>
                <textarea id="parecer" rows="4" placeholder="Descreva aqui a conduta nutricional recomendada..."></textarea>
            </section>

            <div class="actions">
                <button type="button" class="btn-save" onclick="processarSalvamento()">游 Salvar Avalia칞칚o no Prontu치rio</button>
            </div>
        </form>
    </div>

    <script src="app.js"></script>

    <script>
        // Fun칞칚o para atualizar a idade usando sua fun칞칚o do app.js
        function atualizarIdade() {
            const dataNasc = document.getElementById("dataNasc").value;
            const idade = calcularIdade(dataNasc);
            document.getElementById("idade").value = idade + " anos";
        }

        // Fun칞칚o que orquestra todos os c치lculos em tempo real
        function executarCalculos() {
            const peso = getNum("peso");
            const altura = getNum("altura");
            const mna = getNum("mna");
            const nrs = getNum("nrs");

            if (peso > 0 && altura > 0) {
                // C치lculo do IMC
                const imcVal = peso / (altura * altura);
                document.getElementById("imc").value = imcVal.toFixed(2);
                document.getElementById("classImc").value = classificarIMC(imcVal);

                // C치lculo do ICN (Usando sua f칩rmula do app.js)
                const icnVal = calcularICN(mna, nrs, imcVal);
                document.getElementById("icn").value = icnVal.toFixed(1);
                document.getElementById("classIcn").value = classificarICN(icnVal);
            }
        }

        // Fun칞칚o para salvar os dados no Banco Central (bancoILPI)
        function processarSalvamento() {
            const nome = document.getElementById("nome").value;
            const dataAval = new Date().toISOString().split('T')[0]; // Data de hoje

            if (!nome) {
                alert("Por favor, insira o nome do residente.");
                return;
            }

            const avaliacao = {
                data: dataAval,
                idade: document.getElementById("idade").value,
                peso: getNum("peso"),
                altura: getNum("altura"),
                imc: getNum("imc"),
                classificacaoIMC: document.getElementById("classImc").value,
                mna: getNum("mna"),
                nrs: getNum("nrs"),
                icn: getNum("icn"),
                classIcn: document.getElementById("classIcn").value,
                parecer: document.getElementById("parecer").value
            };

            // Chama sua fun칞칚o do app.js
            salvarAvaliacao(nome, avaliacao);

            if (confirm("Avalia칞칚o salva com sucesso! Deseja ver o Dashboard?")) {
                window.location.href = "dashboard.html";
            }
        }
    </script>
</body>
</html>
