<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <title>Avalia√ß√£o Nutricional - Lar Padre Euclides</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="navbar">
        <img src="logo.png" alt="Logo" style="height: 60px; margin-right: 30px;">
        <a href="index.html">Nova Avalia√ß√£o</a>
        <a href="dashboard.html">Dashboard</a>
        <a href="ficha-completa.html">Ficha Cl√≠nica</a>
        <a href="exames-laboratoriais.html">Exames</a>
    </div>

    <div class="container">
        <header>
            <h1>Avalia√ß√£o Nutricional Integrada</h1>
            <p>Calculadora Autom√°tica MNA, NRS-2002 e ICN</p>
        </header>

        <form id="formAvaliacao">
            <section>
                <h3>1. Identifica√ß√£o</h3>
                <div class="grid">
                    <div><label>Nome Completo</label><input type="text" id="nome" required></div>
                    <div><label>Sexo</label><select id="sexo" onchange="executarCalculos()"><option value="F">Feminino</option><option value="M">Masculino</option></select></div>
                    <div><label>Data de Nascimento</label><input type="date" id="dataNasc" onchange="atualizarIdade()"></div>
                    <div><label>Idade Atual</label><input type="text" id="idade_display" readonly></div>
                    <input type="hidden" id="idade_val">
                </div>
            </section>

            <section>
                <h3>2. Antropometria</h3>
                <div class="grid">
                    <div><label>Peso (kg)</label><input type="number" step="0.1" id="peso" oninput="executarCalculos()"></div>
                    <div><label>Altura Real (m)</label><input type="number" step="0.01" id="altura" oninput="executarCalculos()"></div>
                    <div><label>Alt. Joelho (cm)</label><input type="number" step="0.1" id="altJoelho" oninput="executarCalculos()"></div>
                </div>
                <div class="grid" style="margin-top:20px;">
                    <div><label>IMC</label><input type="text" id="imc" readonly></div>
                    <div><label>CP Ajustada</label><input type="text" id="cpAjustada" readonly></div>
                </div>
            </section>

            <section>
                <h3>3. MNA - Mini Avalia√ß√£o Nutricional</h3>
                <div class="grid">
                    <div><label>A. Ingesta Alimentar</label>
                        <select id="mna_a" onchange="executarCalculos()">
                            <option value="2">Sem diminui√ß√£o</option><option value="1">Diminui√ß√£o moderada</option><option value="0">Diminui√ß√£o grave</option>
                        </select>
                    </div>
                    <div><label>B. Perda de Peso (3 meses)</label>
                        <select id="mna_b" onchange="executarCalculos()">
                            <option value="3">Sem perda</option><option value="2">1 a 3 kg</option><option value="1">N√£o sabe</option><option value="0">> 3 kg</option>
                        </select>
                    </div>
                    <div><label>C. Mobilidade</label>
                        <select id="mna_c" onchange="executarCalculos()">
                            <option value="2">Sai de casa</option><option value="1">Sai da cama/cadeira</option><option value="0">Restrito √† cama</option>
                        </select>
                    </div>
                </div>
                <div class="grid">
                    <div><label>D. Stress Psicol√≥gico</label><select id="mna_d" onchange="executarCalculos()"><option value="2">N√£o</option><option value="0">Sim</option></select></div>
                    <div><label>E. Problemas Neuropsic.</label><select id="mna_e" onchange="executarCalculos()"><option value="2">Sem problemas</option><option value="1">Dem√™ncia leve</option><option value="0">Dem√™ncia grave</option></select></div>
                    <div><label>F. Pontos IMC (MNA)</label><select id="mna_f" onchange="executarCalculos()"><option value="3">IMC > 23</option><option value="2">IMC 21-23</option><option value="1">IMC 19-21</option><option value="0">IMC < 19</option></select></div>
                </div>
                <div style="background:#eef9f1; padding:15px; border-radius:10px; margin-top:10px;">
                    <strong>MNA Score: <span id="mna_total_display">0</span> pts</strong> - <span id="mna_status_display">Aguardando</span>
                </div>
                <input type="hidden" id="mna_g" value="0"><input type="hidden" id="mna_h" value="0"><input type="hidden" id="mna_i" value="0"><input type="hidden" id="mna_j" value="0"><input type="hidden" id="mna_k" value="0"><input type="hidden" id="mna_l" value="0"><input type="hidden" id="mna_m" value="0"><input type="hidden" id="mna_n" value="0"><input type="hidden" id="mna_o" value="0"><input type="hidden" id="mna_p" value="0"><input type="hidden" id="mna_q" value="0"><input type="hidden" id="mna_r" value="0">
            </section>

            <section>
                <h3>4. NRS-2002</h3>
                <div class="grid">
                    <div><label>Estado Nutricional (0-3)</label>
                        <select id="nrs_status" onchange="executarCalculos()">
                            <option value="0">0: Normal</option><option value="1">1: Leve</option><option value="2">2: Moderado</option><option value="3">3: Grave</option>
                        </select>
                    </div>
                    <div><label>Gravidade da Doen√ßa (0-3)</label>
                        <select id="nrs_gravidade" onchange="executarCalculos()">
                            <option value="0">0: Normal</option><option value="1">1: Leve (Fratura/Cr√≥nico)</option><option value="2">2: Moderada (Cirurgia/Pneumonia)</option><option value="3">3: Grave (UTI/Trauma)</option>
                        </select>
                    </div>
                </div>
                <div style="background:#eef9f1; padding:15px; border-radius:10px; margin-top:10px;">
                    <strong>NRS Score: <span id="nrs_total_display">0</span> pts</strong> - <span id="nrs_status_display">Sem Risco</span>
                </div>
            </section>

            <section style="border-top: 3px solid var(--primary-color); padding-top:30px;">
                <h3>5. Diagn√≥stico Final (ICN e PES)</h3>
                <div class="grid">
                    <div><label>ICN Final</label><input type="text" id="icn" readonly style="font-size:1.5rem; font-weight:bold; color:var(--primary-color);"></div>
                    <div><label>Status de Risco</label><input type="text" id="classIcn" readonly style="font-size:1.5rem; font-weight:bold;"></div>
                </div>
                <textarea id="parecer" rows="6" style="margin-top:20px; font-style:italic;"></textarea>
            </section>

            <button type="button" class="btn-save" onclick="processarSalvamento()">üíæ Salvar Avalia√ß√£o Completa</button>
        </form>
    </div>

    <script src="app.js"></script>
    <script>
        function atualizarIdade() {
            const data = document.getElementById("dataNasc").value;
            const idade = calcularIdade(data);
            document.getElementById("idade_display").value = idade + " anos";
            document.getElementById("idade_val").value = idade;
            executarCalculos();
        }

        function executarCalculos() {
            const peso = getNum("peso");
            let altura = getNum("altura");
            const aj = getNum("altJoelho");
            const idade = parseInt(document.getElementById("idade_val").value) || 0;
            const sexo = document.getElementById("sexo").value;

            if (altura === 0 && aj > 0 && idade > 0) {
                altura = estimarAltura(aj, idade, sexo);
                document.getElementById("imc").value = (peso/(altura*altura)).toFixed(2);
            }

            if (peso > 0 && altura > 0) {
                const imcVal = peso / (altura * altura);
                document.getElementById("imc").value = imcVal.toFixed(2);
                document.getElementById("cpAjustada").value = ajustarCP(getNum("circPanturrilha"), imcVal).toFixed(1) + " cm";

                const mnaTotal = calcularSomaMNA();
                const nrsTotal = calcularSomaNRS(idade);
                
                document.getElementById("mna_total_display").innerText = mnaTotal;
                document.getElementById("mna_status_display").innerText = classificarMNA(mnaTotal);
                document.getElementById("nrs_total_display").innerText = nrsTotal;
                document.getElementById("nrs_status_display").innerText = classificarNRS(nrsTotal);

                const icnVal = calcularICN(mnaTotal, nrsTotal, imcVal);
                const sIcn = classificarICN(icnVal);
                document.getElementById("icn").value = icnVal.toFixed(1);
                document.getElementById("classIcn").value = sIcn;
                document.getElementById("classIcn").style.color = sIcn.includes("Alto") ? "red" : "green";

                document.getElementById("parecer").value = gerarParecerPES(classificarMNA(mnaTotal), classificarNRS(nrsTotal), sIcn, imcVal, ajustarCP(getNum("circPanturrilha"), imcVal), sexo);
            }
        }

        function processarSalvamento() {
            const nome = document.getElementById("nome").value;
            if(!nome) return alert("Insira o nome!");
            const aval = {
                data: new Date().toLocaleDateString(),
                nome: nome,
                icn: document.getElementById("icn").value,
                classIcn: document.getElementById("classIcn").value,
                parecer: document.getElementById("parecer").value
            };
            salvarAvaliacao(nome, aval);
            alert("Avalia√ß√£o guardada!");
        }
    </script>
</body>
</html>
