<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Dashboard Institucional</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="style.css">
</head>

<body>
<div class="container">

<h1>Painel Institucional - ILPI</h1>

<div id="indicadores" class="grid"></div>

<h2>Evolução IMC</h2>
<canvas id="graficoIMC"></canvas>

</div>

<script>

let registros = JSON.parse(localStorage.getItem("avaliacoes")) || [];

let total = registros.length;

let normal = 0;
let risco = 0;
let desnutrido = 0;
let riscoNRS = 0;

let somaIMC = 0;
let somaMNA = 0;
let somaNRS = 0;

registros.forEach(r => {

    let mna = parseFloat(r.mna);
    let nrs = parseFloat(r.nrs);
    let imc = parseFloat(r.imc);

    somaIMC += imc;
    somaMNA += mna;
    somaNRS += nrs;

    if(mna >= 24) normal++;
    else if(mna >= 17) risco++;
    else desnutrido++;

    if(nrs >= 3) riscoNRS++;
});

function percent(valor){
    if(total === 0) return "0%";
    return ((valor/total)*100).toFixed(1) + "%";
}

document.getElementById("indicadores").innerHTML = `
<div><strong>Total Avaliações:</strong> ${total}</div>
<div><strong>% Estado Normal:</strong> ${percent(normal)}</div>
<div><strong>% Risco MNA:</strong> ${percent(risco)}</div>
<div><strong>% Desnutrição:</strong> ${percent(desnutrido)}</div>
<div><strong>% Risco NRS:</strong> ${percent(riscoNRS)}</div>
<div><strong>Média IMC:</strong> ${total ? (somaIMC/total).toFixed(2) : 0}</div>
<div><strong>Média MNA:</strong> ${total ? (somaMNA/total).toFixed(2) : 0}</div>
<div><strong>Média NRS:</strong> ${total ? (somaNRS/total).toFixed(2) : 0}</div>
`;

let datas = registros.map(r => r.data);
let imcs = registros.map(r => r.imc);

new Chart(document.getElementById("graficoIMC"), {
    type: 'line',
    data: {
        labels: datas,
        datasets: [{
            label: "Evolução IMC",
            data: imcs
        }]
    }
});

</script>

</body>
</html>
