<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <title>Avalia√ß√£o Nutricional - Lar Padre Euclides</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="navbar">
        <img src="logo.png" alt="Logo" style="height: 50px; margin-right: 20px;">
        <a href="index.html">Nova Avalia√ß√£o</a>
        <a href="dashboard.html">Dashboard</a>
        <a href="ficha-completa.html">Ficha Cl√≠nica</a>
        <a href="exames-laboratoriais.html">Exames</a>
    </div>

    <div class="container">
        <header><h1>Avalia√ß√£o Nutricional Integrada</h1></header>

        <form id="formAvaliacao">
            <section>
                <h3>1. Identifica√ß√£o</h3>
                <div class="grid">
                    <div><label>Nome Completo</label><input type="text" id="nome" required></div>
                    <div><label>Sexo</label><select id="sexo" onchange="executarCalculos()"><option value="F">Feminino</option><option value="M">Masculino</option></select></div>
                    <div><label>Data de Nascimento</label><input type="date" id="dataNasc" onchange="atualizarIdade()"></div>
                    <div><label>Data de Admiss√£o</label><input type="date" id="dataAdmissao"></div>
                    <div><label>Idade Atual</label><input type="text" id="idade_display" readonly></div>
                    <input type="hidden" id="idade_val">
                </div>
            </section>

            <section style="background: #f0f7ff; border: 2px solid var(--secondary-color);">
                <h3>2. Dados Unificados (MNA & NRS)</h3>
                <div class="grid">
                    <div><label>Ingesta Alimentar (3m)</label><select id="com_ingesta" onchange="executarCalculos()"><option value="2">Normal</option><option value="1">Moderada</option><option value="0">Grave</option></select></div>
                    <div><label>Perda de Peso (3m)</label><select id="com_perda" onchange="executarCalculos()"><option value="0">Sem perda</option><option value="6">5-10%</option><option value="11">>10%</option></select></div>
                </div>
            </section>

            <section>
                <h3>3. Antropometria</h3>
                <div class="grid">
                    <div><label>Peso (kg)</label><input type="number" step="0.1" id="peso" oninput="executarCalculos()"></div>
                    <div><label>Altura Real (m)</label><input type="number" step="0.01" id="altura" oninput="executarCalculos()"></div>
                    <div><label>Alt. Joelho (cm)</label><input type="number" step="0.1" id="altJoelho" oninput="executarCalculos()"></div>
                </div>
                <div class="grid">
                    <div><label>Circ. Bra√ßo (cm)</label><input type="number" id="circBraco" oninput="executarCalculos()"></div>
                    <div><label>Circ. Panturrilha (cm)</label><input type="number" id="circPanturrilha" oninput="executarCalculos()"></div>
                    <div><label>CP Ajustada (Prado)</label><input type="text" id="cpAjustada" readonly></div>
                </div>
            </section>

            <section>
                <h3>4. MNA Completa (30 pts) e NRS-2002</h3>
                <div class="grid">
                    <div><label>MNA G: Vive Independente?</label><select id="mna_g" onchange="executarCalculos()"><option value="1">Sim</option><option value="0">N√£o (ILPI)</option></select></div>
                    <div><label>NRS: Gravidade Doen√ßa</label><select id="nrs_gravidade" onchange="executarCalculos()"><option value="0">Normal</option><option value="1">Leve</option><option value="2">Moderada</option><option value="3">Grave</option></select></div>
                </div>
                <input type="hidden" id="mna_a"><input type="hidden" id="mna_b"><input type="hidden" id="mna_c" value="2"><input type="hidden" id="mna_d" value="2"><input type="hidden" id="mna_e" value="2"><input type="hidden" id="mna_f">
                <input type="hidden" id="mna_h" value="1"><input type="hidden" id="mna_i" value="1"><input type="hidden" id="mna_j" value="2"><input type="hidden" id="mna_k" value="1"><input type="hidden" id="mna_l" value="1"><input type="hidden" id="mna_m" value="1"><input type="hidden" id="mna_n" value="2"><input type="hidden" id="mna_o" value="2"><input type="hidden" id="mna_p" value="2"><input type="hidden" id="mna_q" value="1"><input type="hidden" id="mna_r" value="1">
                <input type="hidden" id="nrs_status">
                
                <div style="margin-top:20px; font-weight:bold; color:var(--primary-color);">
                    MNA Score: <span id="mna_score">0</span> | NRS Score: <span id="nrs_score">0</span>
                </div>
            </section>

            <section>
                <h3>5. Diagn√≥stico PES</h3>
                <div class="grid">
                    <div><label>ICN Final</label><input type="text" id="icn" readonly></div>
                    <div><label>Status Risco</label><input type="text" id="classIcn" readonly></div>
                </div>
                <textarea id="parecer" rows="5" style="margin-top:20px;"></textarea>
            </section>

            <button type="button" class="btn-save" onclick="processarSalvamento()">üíæ SALVAR AVALIA√á√ÉO</button>
        </form>
    </div>

    <script src="app.js"></script>
    <script>
        function atualizarIdade() {
            const idade = calcularIdade(document.getElementById("dataNasc").value);
            document.getElementById("idade_display").value = idade + " anos";
            document.getElementById("idade_val").value = idade;
            executarCalculos();
        }

        function executarCalculos() {
            const peso = getNum("peso");
            let altura = getNum("altura") || estimarAltura(getNum("altJoelho"), getNum("idade_val"), document.getElementById("sexo").value);
            const imc = peso / (altura * altura);
            
            // Sincroniza√ß√£o
            document.getElementById("mna_a").value = document.getElementById("com_ingesta").value;
            document.getElementById("mna_b").value = document.getElementById("com_perda").value > 0 ? 0 : 3;
            document.getElementById("mna_f").value = imc >= 23 ? 3 : (imc >= 21 ? 2 : 1);
            
            let nrsS = 0;
            const p = getNum("com_perda");
            if(p > 5) nrsS = 1; // Simplificado para o fluxo de triagem
            document.getElementById("nrs_status").value = nrsS;

            const mna = calcularSomaMNA();
            const nrs = calcularSomaNRS(getNum("idade_val"));
            const icn = calcularICN(mna, nrs, imc);
            const cpA = ajustarCP(getNum("circPanturrilha"), imc);

            document.getElementById("mna_score").innerText = mna;
            document.getElementById("nrs_score").innerText = nrs;
            document.getElementById("cpAjustada").value = cpA.toFixed(1) + " cm";
            document.getElementById("icn").value = icn.toFixed(1);
            document.getElementById("classIcn").value = classificarICN(icn);
            document.getElementById("parecer").value = gerarParecerPES(classificarICN(icn), imc, cpA, document.getElementById("sexo").value, mna, nrs);
        }

        function processarSalvamento() {
            const nome = document.getElementById("nome").value;
            if(!nome) return alert("Insira o nome!");
            salvarAvaliacao(nome, { data: new Date().toLocaleDateString(), icn: document.getElementById("icn").value, classIcn: document.getElementById("classIcn").value, parecer: document.getElementById("parecer").value });
            alert("Salvo!");
        }
    </script>
</body>
</html>
