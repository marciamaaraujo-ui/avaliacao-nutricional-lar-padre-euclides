<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <title>Nova Avalia√ß√£o - Lar Padre Euclides</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="navbar"><div class="nav-container"><img src="logo.png" class="nav-logo">
        <div class="nav-links">
            <a href="index.html" class="nav-link home-btn">üè† In√≠cio</a>
            <a href="dashboard.html" class="nav-link">üìä Dashboard</a>
            <a href="ficha-completa.html" class="nav-link">üìÇ Ficha</a>
            <a href="exames-laboratoriais.html" class="nav-link">üß™ Exames</a>
            <a href="comorbidades.html" class="nav-link">üè• Doen√ßas</a>
            <a href="metodologia.html" class="nav-link">üìö M√©todos</a>
    </div></div></div>

    <div class="container">
        <header><h1>Avalia√ß√£o Nutricional Integrada</h1></header>
        <form id="formAval">
            <section>
                <h3>1. Identifica√ß√£o</h3>
                <div class="grid">
                    <div><label>Nome</label><input type="text" id="nome" required></div>
                    <div><label>Sexo</label><select id="sexo" onchange="executarCalculos()"><option value="F">Feminino</option><option value="M">Masculino</option></select></div>
                    <div><label>Nascimento</label><input type="date" id="dataNasc" onchange="atualizarIdade()"></div>
                    <div><label>Idade Atual</label><input type="text" id="idade_display" readonly></div>
                </div>
            </section>

            <section style="background: #f0f7ff; border: 2px solid var(--secondary-color);">
                <h3>2. Dados Unificados (Triagem)</h3>
                <div class="grid">
                    <div><label>Ingesta (3m)</label><select id="com_ingesta" onchange="executarCalculos()"><option value="2">Normal</option><option value="1">Moderada</option><option value="0">Grave</option></select></div>
                    <div><label>Perda Peso (3m)</label><select id="com_perda" onchange="executarCalculos()"><option value="0">Sem perda</option><option value="6">5-10%</option><option value="11">>10%</option></select></div>
                </div>
            </section>

            <section>
                <h3>3. Antropometria</h3>
                <div class="grid">
                    <div><label>Peso (kg)</label><input type="number" step="0.1" id="peso" oninput="executarCalculos()"></div>
                    <div><label>Alt. Joelho (cm)</label><input type="number" id="altJoelho" oninput="executarCalculos()"></div>
                    <div><label>Circ. Panturrilha (cm)</label><input type="number" id="circPanturrilha" oninput="executarCalculos()"></div>
                </div>
                <div class="grid">
                    <div><label>IMC Lipschitz</label><input type="text" id="imc" readonly></div>
                    <div><label>CP Ajustada (Prado)</label><input type="text" id="cpAjustada" readonly></div>
                </div>
            </section>

            <input type="hidden" id="mna_a"><input type="hidden" id="mna_b"><input type="hidden" id="mna_f">
            <input type="hidden" id="mna_c" value="2"><input type="hidden" id="mna_d" value="2"><input type="hidden" id="mna_e" value="2">
            <input type="hidden" id="mna_g" value="0"><input type="hidden" id="mna_h" value="1"><input type="hidden" id="mna_i" value="1"><input type="hidden" id="mna_j" value="2"><input type="hidden" id="mna_k" value="1"><input type="hidden" id="mna_l" value="1"><input type="hidden" id="mna_m" value="1"><input type="hidden" id="mna_n" value="2"><input type="hidden" id="mna_o" value="2"><input type="hidden" id="mna_p" value="2"><input type="hidden" id="mna_q" value="1"><input type="hidden" id="mna_r" value="1">
            <input type="hidden" id="nrs_status"><input type="hidden" id="nrs_gravidade" value="0">

            <section>
                <h3>4. Diagn√≥stico PES Autom√°tico</h3>
                <div class="grid">
                    <div><label>ICN Final</label><input type="text" id="icn" readonly></div>
                    <div><label>Status</label><input type="text" id="classIcn" readonly></div>
                </div>
                <textarea id="parecer" rows="6" style="margin-top:20px;"></textarea>
            </section>

            <button type="button" class="btn-save" onclick="salvar()">üíæ FINALIZAR AVALIA√á√ÉO</button>
        </form>
    </div>
    <script src="app.js"></script>
    <script>
        function atualizarIdade() {
            const nasc = new Date(document.getElementById("dataNasc").value);
            const idade = new Date().getFullYear() - nasc.getFullYear();
            document.getElementById("idade_display").value = idade + " anos";
            executarCalculos();
        }
        function executarCalculos() {
            const peso = getNum("peso"); const aj = getNum("altJoelho"); const sexo = document.getElementById("sexo").value;
            const idade = parseInt(document.getElementById("idade_display").value) || 75;
            let altura = estimarAltura(aj, idade, sexo); const imc = peso / (altura * altura);
            
            document.getElementById("mna_a").value = document.getElementById("com_ingesta").value;
            document.getElementById("mna_b").value = document.getElementById("com_perda").value > 0 ? 0 : 3;
            document.getElementById("mna_f").value = imc >= 23 ? 3 : (imc >= 21 ? 2 : 1);
            document.getElementById("nrs_status").value = getNum("com_perda") > 0 ? 1 : 0;

            const mna = calcularSomaMNA(); const nrs = calcularSomaNRS(idade);
            const icn = (mna * 0.4) + (nrs * 0.4) + (imc < 22 ? 2 : 0);
            const cpA = ajustarCP(getNum("circPanturrilha"), imc);

            document.getElementById("imc").value = imc.toFixed(2);
            document.getElementById("cpAjustada").value = cpA.toFixed(1) + " cm";
            document.getElementById("icn").value = icn.toFixed(1);
            const status = classificarICN(icn);
            document.getElementById("classIcn").value = status;
            document.getElementById("parecer").value = gerarParecerPES(status, imc, cpA, sexo, mna, nrs);
        }
        function salvar() {
            const n = document.getElementById("nome").value; if(!n) return alert("Nome obrigat√≥rio!");
            salvarAvaliacaoCompleta(n, document.getElementById("sexo").value, document.getElementById("dataNasc").value, { data: new Date().toLocaleDateString(), icn: document.getElementById("icn").value, classIcn: document.getElementById("classIcn").value, parecer: document.getElementById("parecer").value });
            alert("Dados Salvos!");
        }
    </script>
</body>
</html>
